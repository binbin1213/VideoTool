## 审计要点
- SRT 解析：主进程 `src/main/utils/subtitle/SRTParser.ts:7-14, 62-106`；前端版 `src/renderer/utils/subtitleConverter.ts:137-166`
- ASS 生成：主进程 `src/main/utils/subtitle/ASSGenerator.ts:23-38, 78-91, 97-110, 115-170`；前端版 `src/renderer/utils/subtitleConverter.ts:177-285`
- 统一转换：前端管道 `src/renderer/utils/subtitleConverter.ts:650-721`
- 正则清洗：预设 `src/shared/presets/subtitle-convert/regex-rules.json:3-67`；应用函数 `src/renderer/utils/subtitleConverter.ts:68-85`
- 字幕烧录/封装：FFmpeg 服务 `src/main/services/FFmpegService.ts:552-802, 807-965`；IPC `src/main/ipc/subtitle-burn.handlers.ts:15-35`
- UI：转换页 `src/renderer/components/Features/SubtitleConvertTab.tsx:317-399, 402-485`；烧录页 `src/renderer/components/Features/SubtitleBurnTab.tsx:153-199, 200-303`

## 改进计划
### 时间格式与精度
- 修正 SRT→ASS 时间转换的厘秒处理，改 `substring(0,2)` 为 0-99 取整（如 `Math.floor(ms/10)` 或四舍五入），统一前端与主进程实现。
- 为 ASS→通用格式的时间转换添加健壮性校验与异常容错。

### ASS 文本与样式
- 统一注释样式逻辑：主进程与前端共用规则，确保末尾注释不添加 `\r`，中间注释添加重置标签，已与现有实现一致但需单元测试覆盖。
- 加强文本转义与逗号处理，确保 `Dialogue` Text 字段包含逗号时不破坏格式。

### 预设与分辨率
- 根据视频信息自动选择 `PlayResX/Y`（通过渲染层在调用前端生成函数时传入 `videoHeight`），减少用户出错；主进程生成路径也支持。
- 增加样式参数有效性校验（范围、类型、颜色）。

### 正则规则安全性
- 为默认清洗规则提供“预览与差异”模式（不落盘），并增加规则分组与开关，避免过度替换影响语义。

### FFmpeg 兼容性
- 在硬字幕时对 `copy` 模式强制切换的提示进一步明确；完善 NVENC/QSV/Videotoolbox 参数映射注释与日志。
- 软字幕封装对 ASS/SSA 与 MP4 容器的样式丢失提示已存在，补充 UI 提示与文档说明。

### 测试与验证
- 添加单元测试：
  - SRT 解析/验证：边界用例（空行、错误时间、BOM、非数字序号）。
  - 时间转换：SRT→ASS（毫秒→厘秒）与 ASS→标准格式双向校验。
  - 正则清洗：确保典型句子不被过度替换。
  - ASS 生成：包含注释、水印、多行、逗号文本。
- 集成测试：
  - 软字幕封装（MKV/MP4 多轨）、硬字幕烧录（不同编码器与硬件加速）。

### 用户体验
- 转换页增加“视频分辨率选择/自动检测”选项；烧录页在选择输出扩展名时加入更明确的自动修正提示。

## 交付与步骤
1. 修正时间转换实现（主进程与前端）并补测试。
2. 补充文本转义与 ASS 事件生成的边界处理。
3. 扩展样式与分辨率自适配（基于视频信息）。
4. 增强正则预览与差异查看。
5. 增强 FFmpeg 兼容日志与 UI 提示。
6. 补齐单元与集成测试，验证硬/软字幕全流程。

请确认是否按此计划推进实现与测试。